---
title: "Simulate UMI sequencing data"
author: "Wenjie Sun"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
    number_sections: yes
    theme: united 
    fig_caption: true
    highlight: textmate
    keep_md: false 
always_allow_html: yes
---

```{r echo=F}
library(knitr)
opts_chunk$set(echo=T, TOC=T)
```

# About

Using the unique molecular identifier (UMI), it can overcome the PCR and sequencing error, to identify the small clone barcode with high accuracy.

In this vignette, we will show how to use the simulation tool to simulate the UMI sequencing data.

# Simulation

## Load Package

```{r}
library(CellBarcodeSim)
```

## Simulate barcode sequencing data

Here we generated 20 clones with uniform size distribution from 1 to 200.
The barcode library is a random barcode library 10 bp long.

After 5 cycle of pre-amplification, 8 bp UMI is added to the 5' end of the barcode.
The UMI tagging efficiency is 0.05. Then 15 (20 - 5) PCR cycles are performed.

The sequencing is simulated by ART sequencing simulator, with MSv1 sequencing profile.

```{r}
barcode_library = system.file("data", "random_barcodes.tsv", package = "CellBarcodeSim")

## Simulate a barcode sequencing experiment
simulate_main_umi(
    barcode_library_file = barcode_library,  ## Define the barcode library
    clone_n              = 20,  ## Define the number of clones
    clone_size_dist      = "uniform", ## Define the clone size distribution
    clone_size_dist_par  = list(size_max = 200, size_min = 1),  ## Define the parameters of the clone size distribution
    cycle                = 20,  ## Define the number of total PCR cycles
    efficiency           = 0.705, ## Define the efficiency of the PCR cycle
    error                = 1e-6,  ## Define the error rate of the PCR, mutation per base per cycle
    pcr_read_per_umi     = 50,  ## Define the number of PCR reads per cell (clone_n)
    output_prefix        = "./tmp/simu_seq",  ## Define the output prefix
    ngs_profile          = "MSv1",  ## Define the NGS profile (refer to ART sequencing simulator manual)
    reads_length         = 35,  ## Define the length of the reads
    top_seq              = "AAAAAAAAAAGGGGG",  ## Define the fixed sequence at the 5' end of the reads to be added
    bottom_seq           = "TTTTTTTTTT",  ## Define the fixed sequence at the 3' end of the reads to be added
    sequence_trunk       = 10, ## Define the length of the fixed sequence to be added
    preamp_n             = 5,  ## Define the number of pre-amplification cycles
    umi_length           = 8,  ## Define the length of the UMI
    umi_tagging_efficiency = 0.05, ## Define the efficiency of the UMI tagging
    art_bin              = NULL ## Define the path to the ART sequencing simulator
)
```


